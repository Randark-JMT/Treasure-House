"use strict";(self.webpackChunktreasure_house=self.webpackChunktreasure_house||[]).push([[9210],{3833:e=>{e.exports=JSON.parse('{"permalink":"/blog/2024-08-18-Docker-Image-Chisel","editUrl":"https://github.com/Randark-JMT/Treasure-House/edit/main/blog/2024-08-18-Docker-Image-Chisel/index.md","source":"@site/blog/2024-08-18-Docker-Image-Chisel/index.md","title":"Docker \u955c\u50cf\u4f53\u79ef\u7f29\u5c0f\u6d4b\u8bd5","description":"\u63a2\u7a76 Dockerfile \u4e2d\u7684\u5404\u4e2a\u64cd\u4f5c\u7a76\u7adf\u5bf9\u6700\u7ec8\u7684\u955c\u50cf\u5927\u5c0f\u6709\u591a\u5927\u7684\u5f71\u54cd\uff0c\u5e76\u7ed9\u51fa\u51cf\u5c0f\u955c\u50cf\u4f53\u79ef\u7684\u6280\u5de7","date":"2024-08-18T00:00:00.000Z","tags":[{"inline":true,"label":"Docker","permalink":"/blog/tags/docker"}],"readingTime":3.33,"hasTruncateMarker":true,"authors":[{"name":"\u9648\u6a58mo","title":"Why So Serious?","url":"https://randark.site","imageURL":"https://randark.site/img/logo.jpg","key":"Randark","page":null}],"frontMatter":{"slug":"2024-08-18-Docker-Image-Chisel","title":"Docker \u955c\u50cf\u4f53\u79ef\u7f29\u5c0f\u6d4b\u8bd5","authors":"Randark","tags":["Docker"]},"unlisted":false,"prevItem":{"title":"HashCTF \u7b79\u5907\u6d4b\u8bd5","permalink":"/blog/2024-10-01-HashCTF-Preparation"},"nextItem":{"title":"Docker Swarm with Photon OS","permalink":"/blog/2024-03-19-Docker-Swarm-Init"}}')},5676:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var c=a(3833),t=a(4848),r=a(8453);const s={slug:"2024-08-18-Docker-Image-Chisel",title:"Docker \u955c\u50cf\u4f53\u79ef\u7f29\u5c0f\u6d4b\u8bd5",authors:"Randark",tags:["Docker"]},i=void 0,o={authorsImageUrls:[void 0]},p=[{value:"\u57fa\u7840\u955c\u50cf",id:"\u57fa\u7840\u955c\u50cf",level:2},{value:"\u5bf9 apt \u64cd\u4f5c\u8fdb\u884c\u4f18\u5316",id:"\u5bf9-apt-\u64cd\u4f5c\u8fdb\u884c\u4f18\u5316",level:2},{value:"\u5bf9 RUN \u591a\u6b65\u64cd\u4f5c\u8fdb\u884c\u538b\u7f29",id:"\u5bf9-run-\u591a\u6b65\u64cd\u4f5c\u8fdb\u884c\u538b\u7f29",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u63a2\u7a76 Dockerfile \u4e2d\u7684\u5404\u4e2a\u64cd\u4f5c\u7a76\u7adf\u5bf9\u6700\u7ec8\u7684\u955c\u50cf\u5927\u5c0f\u6709\u591a\u5927\u7684\u5f71\u54cd\uff0c\u5e76\u7ed9\u51fa\u51cf\u5c0f\u955c\u50cf\u4f53\u79ef\u7684\u6280\u5de7"}),"\n",(0,t.jsx)(n.h2,{id:"\u57fa\u7840\u955c\u50cf",children:"\u57fa\u7840\u955c\u50cf"}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd9\u91cc\u91c7\u7528  ",(0,t.jsx)(n.a,{href:"https://github.com/CTF-Archives/ctf-docker-template/tree/main/web-lnmp-php73",children:"ctf-docker-template/web-lnmp-php73 at main \xb7 CTF-Archives/ctf-docker-template"}),"  \u4f5c\u4e3a\u7814\u7a76\u5bf9\u8c61"]}),"\n",(0,t.jsx)(n.p,{children:"\u539f\u59cb\u7684 Dockerfile \u4e3a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:'FROM ubuntu:22.04\n\nARG DEBIAN_FRONTEND=noninteractive\n\nRUN sed -i \'s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g\' /etc/apt/sources.list\n\nRUN sed -i \'s@//.*security.ubuntu.com@//mirrors.ustc.edu.cn@g\' /etc/apt/sources.list\n\nRUN apt-get update\n\n# install apache2\n\nRUN apt-get install -y apache2 libcap2-bin\n\nRUN setcap \'cap_net_bind_service=+ep\' /usr/sbin/apache2\n\n# install php\n\nRUN apt-get install -y php libapache2-mod-php\n\n# As apache is never run as root, change dir ownership\n\nRUN a2disconf other-vhosts-access-log\nRUN chown -Rh www-data:www-data /var/run/apache2\nRUN chown -Rh www-data:www-data /var/log/apache2\n\n# Setup Apache2\n\nRUN a2enmod rewrite headers expires ext_filter\nCOPY ./config/apache2.conf /etc/apache2/apache2.conf\n\n# Copy source page code\n\nCOPY ./src/a.php /var/www/html/a.php\n\nRUN echo "root:yourpassword" | chpasswd\n\nEXPOSE 80\nUSER www-data\n\nENTRYPOINT ["apache2ctl", "-D", "FOREGROUND"]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u5176\u4e2d\u552f\u4e00\u7684\u5916\u90e8\u6587\u4ef6\u4e3a ",(0,t.jsx)(n.code,{children:"a.php"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",metastring:'title="a.php"',children:"<?php\n    phpinfo();\n?>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"img",src:a(9425).A+"",width:"2940",height:"1610"})}),"\n",(0,t.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u6b63\u5e38\u8fd0\u884c\uff0c\u6b63\u5e38\u663e\u793a\u4e86 ",(0,t.jsx)(n.code,{children:"phpinfo"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u6b64\u65f6 docker \u7f16\u8bd1\u51fa\u6765\u7684\u955c\u50cf\u5927\u5c0f\u4e3a ",(0,t.jsx)(n.code,{children:"268MB"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u5bf9-apt-\u64cd\u4f5c\u8fdb\u884c\u4f18\u5316",children:"\u5bf9 apt \u64cd\u4f5c\u8fdb\u884c\u4f18\u5316"}),"\n",(0,t.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u73b0\u5c06\u6240\u6709\u7684 ",(0,t.jsx)(n.code,{children:"apt-get install"})," \u64cd\u4f5c\u4f18\u5316\u4e3a\u4e00\u6b65\u6267\u884c\uff0c\u4f18\u5316\u540e\u7684\u955c\u50cf\u5927\u5c0f\u4e3a ",(0,t.jsx)(n.code,{children:"267MB"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u7136\u540e\uff0c\u5728\u6267\u884c ",(0,t.jsx)(n.code,{children:"apt-get install"})," \u9636\u6bb5\uff0c\u5236\u5b9a\u6700\u5c0f\u5316\u5b89\u88c5\uff0c\u4e5f\u5c31\u662f\u4e0d\u5b89\u88c5\u63a8\u8350\u7684\u8f6f\u4ef6\u5305\uff0c\u5373 ",(0,t.jsx)(n.code,{children:"--no-install-recommends"})," \u53c2\u6570\uff0c\u4f18\u5316\u540e\u7684\u955c\u50cf\u5927\u5c0f\u4e3a ",(0,t.jsx)(n.code,{children:"264MB"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u5176\u6b21\uff0c\u5728\u6267\u884c\u5b8c ",(0,t.jsx)(n.code,{children:"apt-get install"})," \u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5220\u9664 apt \u5305\u7f13\u5b58\u548c\u5305\u7d22\u5f15\u4e86\uff0c\u5373 ",(0,t.jsx)(n.code,{children:"apt clean"})," \u548c ",(0,t.jsx)(n.code,{children:"rm -rf /var/lib/apt/lists/*"})," \u547d\u4ee4\uff0c\u4f18\u5316\u4e4b\u540e\u7684\u955c\u50cf\u5927\u5c0f\u4e3a ",(0,t.jsx)(n.code,{children:"264MB"})]}),"\n",(0,t.jsx)(n.p,{children:"\u6b64\u65f6\u7684 Dockerfile \u4e3a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:'FROM ubuntu:22.04\n\nARG DEBIAN_FRONTEND=noninteractive\n\nRUN sed -i \'s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g\' /etc/apt/sources.list\n\nRUN sed -i \'s@//.*security.ubuntu.com@//mirrors.ustc.edu.cn@g\' /etc/apt/sources.list\n\nRUN apt-get update\n\n# install apache2\n\nRUN apt-get install -y --no-install-recommends apache2 libcap2-bin php libapache2-mod-php\n\nRUN apt clean\n\nRUN rm -rf /var/lib/apt/lists/*\n\nRUN setcap \'cap_net_bind_service=+ep\' /usr/sbin/apache2\n\n# As apache is never run as root, change dir ownership\n\nRUN a2disconf other-vhosts-access-log\nRUN chown -Rh www-data:www-data /var/run/apache2\nRUN chown -Rh www-data:www-data /var/log/apache2\n\n# Setup Apache2\n\nRUN a2enmod rewrite headers expires ext_filter\nCOPY ./config/apache2.conf /etc/apache2/apache2.conf\n\n# Copy source page code\n\nCOPY ./src/a.php /var/www/html/a.php\n\nRUN echo "root:yourpassword" | chpasswd\n\nEXPOSE 80\nUSER www-data\n\nENTRYPOINT ["apache2ctl", "-D", "FOREGROUND"]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5bf9-run-\u591a\u6b65\u64cd\u4f5c\u8fdb\u884c\u538b\u7f29",children:"\u5bf9 RUN \u591a\u6b65\u64cd\u4f5c\u8fdb\u884c\u538b\u7f29"}),"\n",(0,t.jsxs)(n.p,{children:["\u7531\u4e8e\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u5173\u952e\u8bcd ",(0,t.jsx)(n.code,{children:"RUN"}),", ",(0,t.jsx)(n.code,{children:"COPY"})," \u7b49\u90fd\u4f1a\u5728 image \u4e2d\u589e\u52a0\u4e00\u4e2a layer \u8bb0\u5f55\uff0c\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5360\u7528\uff0c\u6240\u4ee5\u53ef\u4ee5\u5bf9\u591a\u4e2a ",(0,t.jsx)(n.code,{children:"RUN"})," \u8bed\u53e5\u8fdb\u884c\u6574\u5408"]}),"\n",(0,t.jsx)(n.p,{children:"\u4f18\u5316\u540e\u7684 Dockerfile \u4e3a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:'FROM ubuntu:22.04\n\nARG DEBIAN_FRONTEND=noninteractive\n\nRUN sed -i \'s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g\' /etc/apt/sources.list && \\\n    sed -i \'s@//.*security.ubuntu.com@//mirrors.ustc.edu.cn@g\' /etc/apt/sources.list && \\\n    apt-get update && \\\n    apt-get install -y --no-install-recommends apache2 libcap2-bin php libapache2-mod-php && \\\n    apt clean && \\\n    rm -rf /var/lib/apt/lists/* && \\\n    setcap \'cap_net_bind_service=+ep\' /usr/sbin/apache2 && \\\n    # As apache is never run as root, change dir ownership\n    a2disconf other-vhosts-access-log && \\\n    chown -Rh www-data:www-data /var/run/apache2 && \\\n    chown -Rh www-data:www-data /var/log/apache2 && \\\n    # Setup Apache2\n    a2enmod rewrite headers expires ext_filter\n\nCOPY ./config/apache2.conf /etc/apache2/apache2.conf\n\n# Copy source page code and configure user\n\nCOPY ./src/a.php /var/www/html/a.php\nRUN echo "root:yourpassword" | chpasswd\nEXPOSE 80\nUSER www-data\n\nENTRYPOINT ["apache2ctl", "-D", "FOREGROUND"]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u4f18\u5316\u4e4b\u540e\u7684\u955c\u50cf\u5927\u5c0f\u4e3a ",(0,t.jsx)(n.code,{children:"209MB"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>i});var c=a(6540);const t={},r=c.createContext(t);function s(e){const n=c.useContext(r);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),c.createElement(r.Provider,{value:n},e.children)}},9425:(e,n,a)=>{a.d(n,{A:()=>c});const c=a.p+"assets/images/d553f27b264d0682d11149d913c57170-57205cfd009c15e25cabef7a642911fa.png"}}]);