"use strict";(self.webpackChunktreasure_house=self.webpackChunktreasure_house||[]).push([[2452],{6582:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Forensic/Traffic-Forensic/Keyboard","title":"USB \u952e\u76d8\u6d41\u91cf\u5206\u6790","description":"\u9996\u5148\u5bf9\u6d41\u91cf\u5305\u5185\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4f7f\u7528 usbhid.data \u4f5c\u4e3a\u7b5b\u9009\u5668\u8fdb\u884c\u6570\u636e\u7b5b\u9009\uff0c\u5c06 hid \u6570\u636e\u6d41\u63d0\u53d6\u51fa\u6765","source":"@site/docs/Forensic/Traffic-Forensic/Keyboard.md","sourceDirName":"Forensic/Traffic-Forensic","slug":"/Forensic/Traffic-Forensic/Keyboard","permalink":"/docs/Forensic/Traffic-Forensic/Keyboard","draft":false,"unlisted":false,"editUrl":"https://github.com/Randark-JMT/Treasure-House/edit/main/docs/Forensic/Traffic-Forensic/Keyboard.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Forensic_Sidebar","previous":{"title":"\u6d41\u91cf\u5206\u6790","permalink":"/docs/Forensic/Traffic-Forensic/"},"next":{"title":"Webshell \u6d41\u91cf\u5206\u6790","permalink":"/docs/Forensic/Traffic-Forensic/Webshell/"}}');var i=r(4848),o=r(8453);const s={},a="USB \u952e\u76d8\u6d41\u91cf\u5206\u6790",c={},l=[];function d(e){const n={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"usb-\u952e\u76d8\u6d41\u91cf\u5206\u6790",children:"USB \u952e\u76d8\u6d41\u91cf\u5206\u6790"})}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\u5bf9\u6d41\u91cf\u5305\u5185\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"usbhid.data"})," \u4f5c\u4e3a\u7b5b\u9009\u5668\u8fdb\u884c\u6570\u636e\u7b5b\u9009\uff0c\u5c06 hid \u6570\u636e\u6d41\u63d0\u53d6\u51fa\u6765"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"tshark -r keyboard.pcapng -T fields -e usbhid.data | sed '/^\\s*$/d' > usbdata.txt\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e\u4f7f\u7528 Python \u811a\u672c\u5bf9 hid \u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u901a\u8fc7\u5b57\u5178\u6620\u5c04\u5c06 hid \u6570\u636e\u8f6c\u6362\u4e3a\u952e\u76d8\u8f93\u5165\u7684\u5b9e\u9645\u6570\u636e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'normalKeys = {"04": "a", "05": "b", "06": "c", "07": "d", "08": "e", "09": "f", "0a": "g", "0b": "h", "0c": "i", "0d": "j", "0e": "k", "0f": "l", "10": "m", "11": "n", "12": "o", "13": "p", "14": "q", "15": "r", "16": "s", "17": "t", "18": "u", "19": "v", "1a": "w", "1b": "x", "1c": "y", "1d": "z", "1e": "1", "1f": "2", "20": "3", "21": "4", "22": "5", "23": "6", "24": "7", "25": "8", "26": "9", "27": "0",\n              "28": "<RET>", "29": "<ESC>", "2a": "<DEL>", "2b": "\\t", "2c": "<SPACE>", "2d": "-", "2e": "=", "2f": "[", "30": "]", "31": "\\\\", "32": "<NON>", "33": ";", "34": "\'","35":"<GA>","36":",","37":".","38":"/","39":"<CAP>","3a":"<F1>","3b":"<F2>","3c":"<F3>","3d":"<F4>","3e":"<F5>","3f":"<F6>","40":"<F7>","41":"<F8>","42":"<F9>","43":"<F10>","44":"<F11>","45":"<F12>"}\nshiftKeys = {"04": "A", "05": "B", "06": "C", "07": "D", "08": "E", "09": "F", "0a": "G", "0b": "H", "0c": "I", "0d": "J", "0e": "K", "0f": "L", "10": "M", "11": "N", "12": "O", "13": "P", "14": "Q", "15": "R", "16": "S", "17": "T", "18": "U", "19": "V", "1a": "W", "1b": "X", "1c": "Y", "1d": "Z", "1e": "!", "1f": "@", "20": "#", "21": "$", "22": "%", "23": "^", "24": "&", "25": "*",\n             "26": "(", "27": ")", "28": "<RET>", "29": "<ESC>", "2a": "<DEL>", "2b": "\\t", "2c": "<SPACE>", "2d": "_", "2e": "+", "2f": "{", "30": "}", "31": "|", "32": "<NON>", "33": "\\"", "34": ":", "35": "<GA>", "36": "<", "37": ">", "38": "?", "39": "<CAP>", "3a": "<F1>", "3b": "<F2>", "3c": "<F3>", "3d": "<F4>", "3e": "<F5>", "3f": "<F6>", "40": "<F7>", "41": "<F8>", "42": "<F9>", "43": "<F10>", "44": "<F11>", "45": "<F12>"}\noutput = []\nkeys = open(\'usbdata.txt\')\nfor line in keys:\n    import re\n    b = re.findall(r\'.{2}\', line)\n    line = \'-\'.join(b)\n    try:\n        if line[0] != \'0\' or (line[1] != \'0\' and line[1] != \'2\') or line[3] != \'0\' or line[4] != \'0\' or line[9] != \'0\' or line[10] != \'0\' or line[12] != \'0\' or line[13] != \'0\' or line[15] != \'0\' or line[16] != \'0\' or line[18] != \'0\' or line[19] != \'0\' or line[21] != \'0\' or line[22] != \'0\' or line[6:8] == "00":\n            continue\n        if line[6:8] in normalKeys.keys():\n            output += [[normalKeys[line[6:8]]],[shiftKeys[line[6:8]]]][line[1] == \'2\']\n        else:\n            output += [\'[unknown]\']\n    except:\n        pass\nkeys.close()\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7528\u6237\u8f93\u5165\u7684\u539f\u59cb\u884c\u4e3a\u5c31\u88ab\u8f6c\u5316\u5e76\u50a8\u5b58\u5728 output \u53d8\u91cf\u4e2d, \u8fdb\u4e00\u6b65\u5206\u6790\u5927\u5199\u952e\u548c\u5220\u9664\u952e\u7684\u884c\u4e3a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'flag = 0\nprint("".join(output))\nfor i in range(len(output)):\n    try:\n        a = output.index(\'<DEL>\')\n        del output[a]\n        del output[a-1]\n    except:\n        pass\nfor i in range(len(output)):\n    try:\n        if output[i] == "<CAP>":\n            flag += 1\n            output.pop(i)\n            if flag == 2:\n                flag = 0\n        if flag != 0:\n            output[i] = output[i].upper()\n    except:\n        pass\nprint(\'output :\' + "".join(output))\n'})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var t=r(6540);const i={},o=t.createContext(i);function s(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);