<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://treasure-house.randark.site/blog</id>
    <title>Randark_JMT - 陈橘墨 Blog</title>
    <updated>2025-10-02T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://treasure-house.randark.site/blog"/>
    <subtitle>Randark_JMT - 陈橘墨 Blog</subtitle>
    <icon>http://treasure-house.randark.site/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Viper Docker 镜像分析]]></title>
        <id>http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis</id>
        <link href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis"/>
        <updated>2025-10-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Viper 在刚出来的那段时间可谓是炙手可热的项目，极大降低了 Metasploit 框架的使用难度，但是在 2025 年的今天，随着热度下降，以及 Viper 项目进入收费机制，项目已经完全变味，热度也大大下降]]></summary>
        <content type="html"><![CDATA[<p>Viper 在刚出来的那段时间可谓是炙手可热的项目，极大降低了 Metasploit 框架的使用难度，但是在 2025 年的今天，随着热度下降，以及 Viper 项目进入收费机制，项目已经完全变味，热度也大大下降</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>而且是及其难看的收费机制，居然会限制单个session的在线时间，限制session数量都情有可原</p></div></div>
<p>本项目仅作为技术分析，请勿用于非法用途和侵犯原作者的行为</p>
<p>本文章使用的镜像为</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">viperplatform/viper   latest    9513b84d3d58   5 weeks ago    3.95GB</span><br></span></code></pre></div></div>
<p>其基本 Layer 哈希信息为</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-xvf</span><span class="token plain"> viper-9513b84d3d58.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/32079183c93f5213250b9f2b85556470833e1ad9607e1b461a3db8e19746784d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/53b2667516cce81908e88d950dfc251493320e368be75c4a8ec15a376bb30950</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/54f5d0ced7ca0e9e0c57a9358966ec5206a7d82c686fd573b7b3bdc8579a422c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/886d5655721a85a9f24eef774a103f2002683cf7fd07ddc53211b5fb2f7cfdf6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/89dc7ea66d5cb680bb22f10adb79b646d7dd4a86ef05e2a5ebeeac7c70eaa4ed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/9513b84d3d5864c44ff59410e57980cc4f9f536ef16dca161f27d21a8b27c45d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/9704eff5023b3688dc598b7cdfb54fa9da0db47acbc3e331dd2bd3877736bbb4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/af188efa357f5bccef10ccdd433df6f56af97b181acc6bfaa5c4f24128f46292</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/d3170396eeb98bd52bdf1c8dc5cc5f432bd3b8444c1d50c422e67673c1af5033</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x index.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x manifest.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x oci-layout</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-history-分析">Docker history 分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#docker-history-%E5%88%86%E6%9E%90" class="hash-link" aria-label="Docker history 分析的直接链接" title="Docker history 分析的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">history</span><span class="token plain"> --no-trunc 9513b84d3d58</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMAGE                                                                     CREATED        CREATED BY                                                                                                                                                         SIZE      COMMENT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sha256:9513b84d3d5864c44ff59410e57980cc4f9f536ef16dca161f27d21a8b27c45d   </span><span class="token number">5</span><span class="token plain"> weeks ago    CMD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"diypassword"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">                                                                                                                                                0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    ENTRYPOINT </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"viper"</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"init"</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-pw"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">                                                                                                                                  0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    CMD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"diypassword"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">                                                                                                                                                0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    ENTRYPOINT </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"viper"</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"init"</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-pw"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">                                                                                                                                  0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    RUN </span><span class="token operator">|</span><span class="token number">3</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ZSTD_COMPRESS</span><span class="token operator">=</span><span class="token plain">true </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ZSTD_COMPRESS_LEVEL</span><span class="token operator">=</span><span class="token number">22</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">COMPRESS_LAYER</span><span class="token operator">=</span><span class="token plain">true /bin/sh </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-c</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> a+x /root/viper/Docker/build.sh </span><span class="token operator">&amp;&amp;</span><span class="token plain"> ./root/viper/Docker/build.sh </span><span class="token comment" style="color:rgb(98, 114, 164)"># buildkit   1.08GB    buildkit.dockerfile.v0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    COPY rex-socket /root/rex-socket/ </span><span class="token comment" style="color:rgb(98, 114, 164)"># buildkit                                                                                                                       257kB     buildkit.dockerfile.v0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    COPY rex-core /root/rex-core/ </span><span class="token comment" style="color:rgb(98, 114, 164)"># buildkit                                                                                                                           143kB     buildkit.dockerfile.v0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    COPY viperjs/dist /root/viper/dist/ </span><span class="token comment" style="color:rgb(98, 114, 164)"># buildkit                                                                                                                     6.15MB    buildkit.dockerfile.v0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    COPY vipermsf /root/metasploit-framework/ </span><span class="token comment" style="color:rgb(98, 114, 164)"># buildkit                                                                                                               422MB     buildkit.dockerfile.v0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    COPY viperpython /root/viper/ </span><span class="token comment" style="color:rgb(98, 114, 164)"># buildkit                                                                                                                           243MB     buildkit.dockerfile.v0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">COMPRESS_LAYER</span><span class="token operator">=</span><span class="token plain">true                                                                                                                                            0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ZSTD_COMPRESS_LEVEL</span><span class="token operator">=</span><span class="token number">22</span><span class="token plain">                                                                                                                                         0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">5</span><span class="token plain"> weeks ago    ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ZSTD_COMPRESS</span><span class="token operator">=</span><span class="token plain">true                                                                                                                                             0B        buildkit.dockerfile.v0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">missing</span><span class="token operator">&gt;</span><span class="token plain">                                                                 </span><span class="token number">2</span><span class="token plain"> months ago                                                                                                                                                                      </span><span class="token number">2</span><span class="token plain">.2GB     Imported from -</span><br></span></code></pre></div></div>
<p>在其中可以看到镜像的两个入口点</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD ["diypassword"]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENTRYPOINT ["viper" "init" "-pw"]</span><br></span></code></pre></div></div>
<p>其中运行了一次命令，猜测为预编译或者混淆操作</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ZSTD_COMPRESS</span><span class="token operator">=</span><span class="token plain">true </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ZSTD_COMPRESS_LEVEL</span><span class="token operator">=</span><span class="token number">22</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">COMPRESS_LAYER</span><span class="token operator">=</span><span class="token plain">true </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/bin/sh </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-c</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> a+x /root/viper/Docker/build.sh </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./root/viper/Docker/build.sh</span><br></span></code></pre></div></div>
<p>并且涵盖了 5 个外来的数据源作为 layer</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY viperpython /root/viper/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY vipermsf /root/metasploit-framework/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY viperjs/dist /root/viper/dist/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY rex-core /root/rex-core/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY rex-socket /root/rex-socket/</span><br></span></code></pre></div></div>
<p>根据其名字即可猜测，从上而下分别为 viper 的核心代码，与 Metasploit 交互的 SDK 代码，以及前段的代码，后面的两层为 Ruby Exploitation 的相关代码</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="对-image-layer-进行分析">对 Image Layer 进行分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E5%AF%B9-image-layer-%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90" class="hash-link" aria-label="对 Image Layer 进行分析的直接链接" title="对 Image Layer 进行分析的直接链接" translate="no">​</a></h2>
<p>首先将 Docker Image 导出为 tar 格式</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> save 9513b84d3d58 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-o</span><span class="token plain"> viper-9513b84d3d58.tar</span><br></span></code></pre></div></div>
<p>然后解压 tar 文件</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-xvf</span><span class="token plain"> viper-9513b84d3d58.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/32079183c93f5213250b9f2b85556470833e1ad9607e1b461a3db8e19746784d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/53b2667516cce81908e88d950dfc251493320e368be75c4a8ec15a376bb30950</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/54f5d0ced7ca0e9e0c57a9358966ec5206a7d82c686fd573b7b3bdc8579a422c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/886d5655721a85a9f24eef774a103f2002683cf7fd07ddc53211b5fb2f7cfdf6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/89dc7ea66d5cb680bb22f10adb79b646d7dd4a86ef05e2a5ebeeac7c70eaa4ed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/9513b84d3d5864c44ff59410e57980cc4f9f536ef16dca161f27d21a8b27c45d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/9704eff5023b3688dc598b7cdfb54fa9da0db47acbc3e331dd2bd3877736bbb4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/af188efa357f5bccef10ccdd433df6f56af97b181acc6bfaa5c4f24128f46292</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/d3170396eeb98bd52bdf1c8dc5cc5f432bd3b8444c1d50c422e67673c1af5033</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x blobs/sha256/ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x index.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x manifest.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">x oci-layout</span><br></span></code></pre></div></div>
<p>其在磁盘上表现为</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── blobs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp; └── sha256</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 32079183c93f5213250b9f2b85556470833e1ad9607e1b461a3db8e19746784d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 53b2667516cce81908e88d950dfc251493320e368be75c4a8ec15a376bb30950</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 54f5d0ced7ca0e9e0c57a9358966ec5206a7d82c686fd573b7b3bdc8579a422c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 886d5655721a85a9f24eef774a103f2002683cf7fd07ddc53211b5fb2f7cfdf6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 89dc7ea66d5cb680bb22f10adb79b646d7dd4a86ef05e2a5ebeeac7c70eaa4ed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 9513b84d3d5864c44ff59410e57980cc4f9f536ef16dca161f27d21a8b27c45d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── 9704eff5023b3688dc598b7cdfb54fa9da0db47acbc3e331dd2bd3877736bbb4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── af188efa357f5bccef10ccdd433df6f56af97b181acc6bfaa5c4f24128f46292</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     ├── d3170396eeb98bd52bdf1c8dc5cc5f432bd3b8444c1d50c422e67673c1af5033</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│&nbsp;&nbsp;     └── ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── index.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── manifest.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── oci-layout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── viper-9513b84d3d58.tar</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看-manifest">查看 manifest<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E6%9F%A5%E7%9C%8B-manifest" class="hash-link" aria-label="查看 manifest的直接链接" title="查看 manifest的直接链接" translate="no">​</a></h3>
<p>对 <code>manifest.json</code> 文件进行分析</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "Config": "blobs/sha256/9513b84d3d5864c44ff59410e57980cc4f9f536ef16dca161f27d21a8b27c45d",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "RepoTags": null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "Layers": [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "blobs/sha256/8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "LayerSources": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 212992,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 6180352,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 434012672,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 331264,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 1120905728,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 243732480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      "sha256:ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "mediaType": "application/vnd.oci.image.layer.v1.tar",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "size": 2243532800,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        "digest": "sha256:ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">]</span><br></span></code></pre></div></div>
<p>可以看到磁盘上的镜像有 7 层 layer</p>
<p>自上而下进行分析</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token number">1</span><span class="token plain">. blobs/sha256/ef9fbb930591a70192543d4573dca5e928df6089507c42949fc656c22180af0b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">base image</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2</span><span class="token plain">. blobs/sha256/8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> 文件，为数据层  COPY viperpython /root/viper/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain">. blobs/sha256/8263c1ff94453049a1a9f0540bd58cd93030becfbdcea05a94ce161f36594299</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> 文件，为数据层 COPY vipermsf /root/metasploit-framework/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">4</span><span class="token plain">. blobs/sha256/728f9596412839560aa42a607c677d6d1305f8ae2888e777563736571f155555</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> 文件，为数据层` COPY viperjs/dist /root/viper/dist/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">5</span><span class="token plain">. blobs/sha256/28f6bb6daee474076a2e4090ec4651b359e4627a656ab07a01cc338803e096b4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> 文件，为数据层 COPY rex-core /root/rex-core/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">6</span><span class="token plain">. blobs/sha256/88bf9672263d9cb1993971d6f9cb7519d38d1f2df0cd4a4cb477e95003de8922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> 文件，为数据层  COPY rex-socket /root/rex-socket/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">7</span><span class="token plain">. blobs/sha256/8e92b7eb758a15f2ab63305f04cf6adaca2b2ecde812f4838998817c82af3909</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">执行预编译/混淆操作</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>这里就需要提到一个小知识，在 Docker Image 或者说 OCI Image 中，如 TAG 或者 CMD/ENTRYPOINT 操作，是不会新建一个 layer 的，而是作为一条 key<!-- -->:value<!-- --> 记录到镜像的元数据中</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="分析-viper-核心源码">分析 viper 核心源码<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E5%88%86%E6%9E%90-viper-%E6%A0%B8%E5%BF%83%E6%BA%90%E7%A0%81" class="hash-link" aria-label="分析 viper 核心源码的直接链接" title="分析 viper 核心源码的直接链接" translate="no">​</a></h3>
<p>在先前的分析中，已经定位到 viper 的源码位于</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">blobs/sha256/8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49</span><br></span></code></pre></div></div>
<p>尝试对其进行提取</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/Users/randark/Develop/viper-9513b84d3d58/blobs/sha256</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> viperpython</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-xf</span><span class="token plain"> 8e9b05371e29e87e7edfd98cc04ec9918a96574b1f6311ac1f751f533746bf49 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-C</span><span class="token plain"> ./viperpython</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-laih</span><span class="token plain"> ./viperpython/root/viper/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466809</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">24</span><span class="token plain"> randark  staff   768B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466808</span><span class="token plain"> drwx------    </span><span class="token number">3</span><span class="token plain"> randark  staff    96B Jul </span><span class="token number">12</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:31 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466810</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">3</span><span class="token plain"> randark  staff    96B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 .cursor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466813</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">14</span><span class="token plain"> randark  staff   448B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 .git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466858</span><span class="token plain"> -rw-r--r--    </span><span class="token number">1</span><span class="token plain"> randark  staff    74B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 .gitattributes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466859</span><span class="token plain"> -rw-r--r--    </span><span class="token number">1</span><span class="token plain"> randark  staff   </span><span class="token number">2</span><span class="token plain">.8K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 .gitignore</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466860</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">8</span><span class="token plain"> randark  staff   256B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 Core</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466875</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">19</span><span class="token plain"> randark  staff   608B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 Docker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466903</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">15</span><span class="token plain"> randark  staff   480B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 External</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466917</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">35</span><span class="token plain"> randark  staff   </span><span class="token number">1</span><span class="token plain">.1K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 Lib</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34466960</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">35</span><span class="token plain"> randark  staff   </span><span class="token number">1</span><span class="token plain">.1K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 MODULES_DATA</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467126</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">7</span><span class="token plain"> randark  staff   224B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 MODULES_LLM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467132</span><span class="token plain"> drwxr-xr-x  </span><span class="token number">117</span><span class="token plain"> randark  staff   </span><span class="token number">3</span><span class="token plain">.7K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 MODULES_POST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467248</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">8</span><span class="token plain"> randark  staff   256B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 Msgrpc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467272</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">8</span><span class="token plain"> randark  staff   256B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 PostLateral</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467284</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">8</span><span class="token plain"> randark  staff   256B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 PostModule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467301</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">6</span><span class="token plain"> randark  staff   192B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 STATICFILES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467351</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">7</span><span class="token plain"> randark  staff   224B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 Viper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467357</span><span class="token plain"> drwxr-xr-x    </span><span class="token number">5</span><span class="token plain"> randark  staff   160B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 WebSocket</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467364</span><span class="token plain"> drwxr-xr-x   </span><span class="token number">10</span><span class="token plain"> randark  staff   320B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 Worker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467562</span><span class="token plain"> -rw-r--r--    </span><span class="token number">1</span><span class="token plain"> randark  staff   </span><span class="token number">2</span><span class="token plain">.8K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 compile_and_clean.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467563</span><span class="token plain"> -rw-r--r--    </span><span class="token number">1</span><span class="token plain"> randark  staff   537B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 manage.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467564</span><span class="token plain"> -rw-r--r--    </span><span class="token number">1</span><span class="token plain"> randark  staff   </span><span class="token number">1</span><span class="token plain">.3K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 setup.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">34467565</span><span class="token plain"> -rw-r--r--    </span><span class="token number">1</span><span class="token plain"> randark  staff    17K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 viper.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dockerfile-分析">Dockerfile 分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#dockerfile-%E5%88%86%E6%9E%90" class="hash-link" aria-label="Dockerfile 分析的直接链接" title="Dockerfile 分析的直接链接" translate="no">​</a></h3>
<p>此镜像的 <code>Dockerfile</code> 也位于 <code>viperpython</code> 仓库中</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/Users/randark/Develop/viper-9513b84d3d58/blobs/sha256/viperpython</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">find</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-name</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Dockerfile"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./root/viper/Docker/Dockerfile</span><br></span></code></pre></div></div>
<p>具体的 <code>Dockerfile</code> 如下</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token instruction"> registry.cn-shenzhen.aliyuncs.com/toys/viper-base:latest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ARG</span><span class="token instruction"> ZSTD_COMPRESS=true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ARG</span><span class="token instruction"> ZSTD_COMPRESS_LEVEL=22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ARG</span><span class="token instruction"> COMPRESS_LAYER=true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> viperpython /root/viper/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> vipermsf /root/metasploit-framework/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> viperjs/dist /root/viper/dist/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> rex-core /root/rex-core/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> rex-socket /root/rex-socket/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> chmod a+x /root/viper/Docker/build.sh &amp;&amp; ./root/viper/Docker/build.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:rgb(255, 121, 198)">"viper"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"init"</span><span class="token instruction">,</span><span class="token instruction string" style="color:rgb(255, 121, 198)">"-pw"</span><span class="token instruction">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:rgb(255, 121, 198)">"diypassword"</span><span class="token instruction">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#HEALTHCHECK CMD viper healthcheck</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="镜像性能分析">镜像性能分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E9%95%9C%E5%83%8F%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90" class="hash-link" aria-label="镜像性能分析的直接链接" title="镜像性能分析的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="base-image-镜像性能分析">Base Image 镜像性能分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#base-image-%E9%95%9C%E5%83%8F%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90" class="hash-link" aria-label="Base Image 镜像性能分析的直接链接" title="Base Image 镜像性能分析的直接链接" translate="no">​</a></h3>
<p>在 <code>Dockerfile</code> 中可以看到，所使用的基础镜像是</p>
<div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token instruction"> registry.cn-shenzhen.aliyuncs.com/toys/viper-base:latest</span><br></span></code></pre></div></div>
<p>但是这个镜像是一个私有镜像没办法进行分析</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="viper-镜像性能分析">Viper 镜像性能分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#viper-%E9%95%9C%E5%83%8F%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90" class="hash-link" aria-label="Viper 镜像性能分析的直接链接" title="Viper 镜像性能分析的直接链接" translate="no">​</a></h3>
<p>TODO 待填坑</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="绕过收费限制">绕过收费限制<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E7%BB%95%E8%BF%87%E6%94%B6%E8%B4%B9%E9%99%90%E5%88%B6" class="hash-link" aria-label="绕过收费限制的直接链接" title="绕过收费限制的直接链接" translate="no">​</a></h2>
<p>既然已经有了源码和 Docker Image 镜像文件之后，其实就可以直接加上一层 Layer 实现付费逻辑的 patch 修改</p>
<p>TODO 待填坑</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="镜像安全分析">镜像安全分析<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90" class="hash-link" aria-label="镜像安全分析的直接链接" title="镜像安全分析的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-凭据泄漏">Git 凭据泄漏<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#git-%E5%87%AD%E6%8D%AE%E6%B3%84%E6%BC%8F" class="hash-link" aria-label="Git 凭据泄漏的直接链接" title="Git 凭据泄漏的直接链接" translate="no">​</a></h3>
<p>这一点问题非常大了，尤其是使用传统明文凭据的 git 平台</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/Users/randark/Develop/viper-9513b84d3d58/blobs/sha256/viperpython/root/viper/.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total </span><span class="token number">184</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--   </span><span class="token number">1</span><span class="token plain"> randark  staff    21B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 HEAD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x   </span><span class="token number">2</span><span class="token plain"> randark  staff    64B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 branches</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--   </span><span class="token number">1</span><span class="token plain"> randark  staff   361B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--   </span><span class="token number">1</span><span class="token plain"> randark  staff    73B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 description</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x  </span><span class="token number">14</span><span class="token plain"> randark  staff   448B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 hooks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--   </span><span class="token number">1</span><span class="token plain"> randark  staff    71K Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 index</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x   </span><span class="token number">3</span><span class="token plain"> randark  staff    96B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x   </span><span class="token number">4</span><span class="token plain"> randark  staff   128B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x   </span><span class="token number">4</span><span class="token plain"> randark  staff   128B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 objects</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--   </span><span class="token number">1</span><span class="token plain"> randark  staff   112B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 packed-refs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x   </span><span class="token number">5</span><span class="token plain"> randark  staff   160B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 refs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--   </span><span class="token number">1</span><span class="token plain"> randark  staff    41B Aug </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain">:05 shallow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> config </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	repositoryformatversion </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	filemode </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	bare </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	logallrefupdates </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">remote </span><span class="token string" style="color:rgb(255, 121, 198)">"origin"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	url </span><span class="token operator">=</span><span class="token plain"> https://60**76:12**6e@codeup.aliyun.com/60**2e/FunnyWolf/viperpython.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	fetch </span><span class="token operator">=</span><span class="token plain"> +refs/heads/main:refs/remotes/origin/main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">branch </span><span class="token string" style="color:rgb(255, 121, 198)">"main"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	remote </span><span class="token operator">=</span><span class="token plain"> origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	merge </span><span class="token operator">=</span><span class="token plain"> refs/heads/main</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cursor-配置文件泄漏">Cursor 配置文件泄漏<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#cursor-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F" class="hash-link" aria-label="Cursor 配置文件泄漏的直接链接" title="Cursor 配置文件泄漏的直接链接" translate="no">​</a></h3>
<p>泄漏操作位于 <code>COPY viperpython /root/viper/</code> 操作中，没有将 <code>.cursor</code> 文件夹排除在 Docker Build 之外，导致将 <code>.cursor</code> 文件夹包含进了镜像中</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/Develop/viper-9513b84d3d58/blobs/sha256/viperpython/root/viper/.cursor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ tree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── rules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    └── code-style.mdc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2</span><span class="token plain"> directories, </span><span class="token number">1</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> ./rules/code-style.mdc </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">永远不要尝试添加debug和test代码</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">永远不要尝试添加readme.md文件,除非用户明确要求你更新readme.md</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alicloud-yunxiao-凭据泄漏">Alicloud Yunxiao 凭据泄漏<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#alicloud-yunxiao-%E5%87%AD%E6%8D%AE%E6%B3%84%E6%BC%8F" class="hash-link" aria-label="Alicloud Yunxiao 凭据泄漏的直接链接" title="Alicloud Yunxiao 凭据泄漏的直接链接" translate="no">​</a></h2>
<p>使用泄漏的凭据获取敏感数据</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取组织所有储存库">获取组织所有储存库<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E8%8E%B7%E5%8F%96%E7%BB%84%E7%BB%87%E6%89%80%E6%9C%89%E5%82%A8%E5%AD%98%E5%BA%93" class="hash-link" aria-label="获取组织所有储存库的直接链接" title="获取组织所有储存库的直接链接" translate="no">​</a></h3>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> API 原始返回数据 </summary><div><div class="collapsibleContent_i85q"><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "result": [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "finished",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "description": "",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-09-16T09:28:18+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2025-09-16T09:28:18+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 5754835,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-09-16T09:28:18+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "none",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-09-08T16:59:40+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2025-08-29T17:08:50+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 5674743,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-09-08T16:59:40+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "none",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-09-05T20:53:17+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2025-09-03T13:44:35+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 5695503,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-09-05T20:53:17+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "finished",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-08-31T22:29:58+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 975572,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-08-31T22:29:58+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "finished",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-08-31T21:31:24+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 975570,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-08-31T21:31:24+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "finished",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-08-17T22:02:59+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 975571,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-08-17T22:02:59+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "none",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-08-17T19:46:59+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2021-08-11T15:28:11+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 199872,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 1041835,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-08-17T19:46:59+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "none",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-07-12T20:19:55+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2025-04-26T20:38:42+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 5201371,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-07-12T20:19:55+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "none",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2025-05-03T15:06:18+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2021-08-11T15:21:38+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 199872,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 1041809,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2025-05-03T15:06:18+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "importStatus": "finished",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "star": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "lastActivityAt": "2021-07-16T16:38:27+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "archive": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "createdAt": "2021-07-15T09:44:09+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "path": "cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "starCount": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "webUrl": "https://codeup.aliyun.com/60cf4a6dfe6db12c807b672e/FunnyWolf/cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "name": "cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "Id": 979748,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "updatedAt": "2021-07-16T16:38:27+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "total": 10,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "requestId": "4BA084B8-1632-5DC1-9C11-1F8359E658D9",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "success": true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div></div></div></details>
<p>也就是以下仓库</p>
<table><thead><tr><th style="text-align:center">name</th><th style="text-align:center">ID</th></tr></thead><tbody><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / WatchDogKiller</td><td style="text-align:center">5754835</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / ai-soc-framework</td><td style="text-align:center">5674743</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / alert_forwarder</td><td style="text-align:center">5695503</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / viperpython</td><td style="text-align:center">975572</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / viperjs</td><td style="text-align:center">975570</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / vipermsf</td><td style="text-align:center">975571</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / rex-socket</td><td style="text-align:center">1041835</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / mettle</td><td style="text-align:center">5201371</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / rex-core</td><td style="text-align:center">1041809</td></tr><tr><td style="text-align:center">60cf4a6dfe6db12c807b672e / FunnyWolf / cthun3</td><td style="text-align:center">979748</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="审计-token-权限">审计 token 权限<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E5%AE%A1%E8%AE%A1-token-%E6%9D%83%E9%99%90" class="hash-link" aria-label="审计 token 权限的直接链接" title="审计 token 权限的直接链接" translate="no">​</a></h3>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> API 原始返回数据 </summary><div><div class="collapsibleContent_i85q"><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "result": [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "userInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "avatarUrl": "https://tcs-devops.aliyuncs.com/thumbnail/112695aa8a7b148a044eab7ab894283efbd9/w/100/h/100",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "name": "15524174828",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "id": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "state": "active",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "email": "yu5890681@gmail.com",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                "username": "aliyun:15524174828_8Ps"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "repositoryInfos": [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 975570,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-08-31T21:31:24+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 975570,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/viperjs",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-08-31T21:31:24+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 975571,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-08-17T22:02:59+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 975571,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/vipermsf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-08-17T22:02:59+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 975572,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-08-31T22:29:58+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 975572,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/viperpython",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-08-31T22:29:58+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 979748,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2021-07-16T16:38:27+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-07-15T09:44:09+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 979748,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/cthun3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2021-07-16T16:38:27+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 1041809,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-05-03T15:06:18+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-08-11T15:21:38+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 199872,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 1041809,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/rex-core",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-05-03T15:06:18+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 1041835,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-08-17T19:46:59+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-08-11T15:28:11+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 199872,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 1041835,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/rex-socket",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-08-17T19:46:59+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 5201371,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-07-12T20:19:55+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2025-04-26T20:38:42+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 5201371,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/mettle",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-07-12T20:19:55+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 5674743,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-09-08T16:59:40+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2025-08-29T17:08:50+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 5674743,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/ai-soc-framework",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-09-08T16:59:40+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 5695503,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-09-05T20:53:17+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2025-09-03T13:44:35+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 5695503,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/alert_forwarder",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-09-05T20:53:17+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 5754835,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Project",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "repositoryInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "creatorId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "description": "",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "lastActivityAt": "2025-09-16T09:28:18+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2025-09-16T09:28:18+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "archived": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "encrypted": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf / WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "namespaceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 5754835,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf/WatchDogKiller",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2025-09-16T09:28:18+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            "groupInfos": [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "groupInfo": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "path": "FunnyWolf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "createdAt": "2021-07-13T10:13:48+08:00",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "nameWithNamespace": "60cf4a6dfe6db12c807b672e / FunnyWolf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "visibilityLevel": "0",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "name": "FunnyWolf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "description": "",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "id": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "pathWithNamespace": "60cf4a6dfe6db12c807b672e/FunnyWolf",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "ownerId": 550345,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "parentId": 199872,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "updatedAt": "2021-07-13T10:13:48+08:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    "groupRole": {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceId": 212480,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "accessLevel": 40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "sourceType": "Namespace",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "cnRoleName": "管理员",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        "enRoleName": "Admin"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "total": 1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "requestId": "AC0B9C6F-EF1A-5D39-AB6E-49C9B42E84F3",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "success": true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="用户加入的企业列表">用户加入的企业列表<a href="http://treasure-house.randark.site/blog/2025-10-02-VIper-Docker-Image-Analysis#%E7%94%A8%E6%88%B7%E5%8A%A0%E5%85%A5%E7%9A%84%E4%BC%81%E4%B8%9A%E5%88%97%E8%A1%A8" class="hash-link" aria-label="用户加入的企业列表的直接链接" title="用户加入的企业列表的直接链接" translate="no">​</a></h3>
<p>Token 权限不足，没办法查询</p>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="Docker" term="Docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[HashCTF 筹备测试]]></title>
        <id>http://treasure-house.randark.site/blog/2024-10-01-HashCTF-Preparation</id>
        <link href="http://treasure-house.randark.site/blog/2024-10-01-HashCTF-Preparation"/>
        <updated>2024-10-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[HachCTF 只是我的一个构思]]></summary>
        <content type="html"><![CDATA[<p>HachCTF 只是我的一个构思</p>
<p>预先构思：</p>
<ul>
<li>使用 Github Action 作为答案提交以及 Checker</li>
<li>A 仓库 (Public) 存放 Github Action 相关逻辑，以及题目信息，还有选手信息</li>
<li>B 仓库 (Private) 存放题目信息与答案数据</li>
</ul>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker 镜像体积缩小测试]]></title>
        <id>http://treasure-house.randark.site/blog/2024-08-18-Docker-Image-Chisel</id>
        <link href="http://treasure-house.randark.site/blog/2024-08-18-Docker-Image-Chisel"/>
        <updated>2024-08-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[探究 Dockerfile 中的各个操作究竟对最终的镜像大小有多大的影响，并给出减小镜像体积的技巧]]></summary>
        <content type="html"><![CDATA[<p>探究 Dockerfile 中的各个操作究竟对最终的镜像大小有多大的影响，并给出减小镜像体积的技巧</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="基础镜像">基础镜像<a href="http://treasure-house.randark.site/blog/2024-08-18-Docker-Image-Chisel#%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F" class="hash-link" aria-label="基础镜像的直接链接" title="基础镜像的直接链接" translate="no">​</a></h2>
<p>这里采用  <a href="https://github.com/CTF-Archives/ctf-docker-template/tree/main/web-lnmp-php73" target="_blank" rel="noopener noreferrer">ctf-docker-template/web-lnmp-php73 at main · CTF-Archives/ctf-docker-template</a>  作为研究对象</p>
<p>原始的 Dockerfile 为</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token instruction"> ubuntu:22.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ARG</span><span class="token instruction"> DEBIAN_FRONTEND=noninteractive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> sed -i </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g'</span><span class="token instruction"> /etc/apt/sources.list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> sed -i </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'s@//.*security.ubuntu.com@//mirrors.ustc.edu.cn@g'</span><span class="token instruction"> /etc/apt/sources.list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> apt-get update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># install apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> apt-get install -y apache2 libcap2-bin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> setcap </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'cap_net_bind_service=+ep'</span><span class="token instruction"> /usr/sbin/apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># install php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> apt-get install -y php libapache2-mod-php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># As apache is never run as root, change dir ownership</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> a2disconf other-vhosts-access-log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> chown -Rh www-data:www-data /var/run/apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> chown -Rh www-data:www-data /var/log/apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Setup Apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> a2enmod rewrite headers expires ext_filter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> ./config/apache2.conf /etc/apache2/apache2.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Copy source page code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> ./src/a.php /var/www/html/a.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> echo </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"root:yourpassword"</span><span class="token instruction"> | chpasswd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">EXPOSE</span><span class="token instruction"> 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">USER</span><span class="token instruction"> www-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:rgb(255, 121, 198)">"apache2ctl"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"-D"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"FOREGROUND"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<p>其中唯一的外部文件为 <code>a.php</code></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_OeMC">a.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token delimiter important">&lt;?php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">phpinfo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token delimiter important">?&gt;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="http://treasure-house.randark.site/assets/images/d553f27b264d0682d11149d913c57170-57205cfd009c15e25cabef7a642911fa.png" width="2940" height="1610" class="img_ev3q"></p>
<p>可以看到服务正常运行，正常显示了 <code>phpinfo</code></p>
<p>此时 docker 编译出来的镜像大小为 <code>268MB</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="对-apt-操作进行优化">对 apt 操作进行优化<a href="http://treasure-house.randark.site/blog/2024-08-18-Docker-Image-Chisel#%E5%AF%B9-apt-%E6%93%8D%E4%BD%9C%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96" class="hash-link" aria-label="对 apt 操作进行优化的直接链接" title="对 apt 操作进行优化的直接链接" translate="no">​</a></h2>
<p>首先，现将所有的 <code>apt-get install</code> 操作优化为一步执行，优化后的镜像大小为 <code>267MB</code></p>
<p>然后，在执行 <code>apt-get install</code> 阶段，制定最小化安装，也就是不安装推荐的软件包，即 <code>--no-install-recommends</code> 参数，优化后的镜像大小为 <code>264MB</code></p>
<p>其次，在执行完 <code>apt-get install</code> 操作之后，就可以删除 apt 包缓存和包索引了，即 <code>apt clean</code> 和 <code>rm -rf /var/lib/apt/lists/*</code> 命令，优化之后的镜像大小为 <code>264MB</code></p>
<p>此时的 Dockerfile 为</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token instruction"> ubuntu:22.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ARG</span><span class="token instruction"> DEBIAN_FRONTEND=noninteractive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> sed -i </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g'</span><span class="token instruction"> /etc/apt/sources.list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> sed -i </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'s@//.*security.ubuntu.com@//mirrors.ustc.edu.cn@g'</span><span class="token instruction"> /etc/apt/sources.list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> apt-get update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># install apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> apt-get install -y --no-install-recommends apache2 libcap2-bin php libapache2-mod-php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> apt clean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> rm -rf /var/lib/apt/lists/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> setcap </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'cap_net_bind_service=+ep'</span><span class="token instruction"> /usr/sbin/apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># As apache is never run as root, change dir ownership</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> a2disconf other-vhosts-access-log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> chown -Rh www-data:www-data /var/run/apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> chown -Rh www-data:www-data /var/log/apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Setup Apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> a2enmod rewrite headers expires ext_filter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> ./config/apache2.conf /etc/apache2/apache2.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Copy source page code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> ./src/a.php /var/www/html/a.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> echo </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"root:yourpassword"</span><span class="token instruction"> | chpasswd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">EXPOSE</span><span class="token instruction"> 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">USER</span><span class="token instruction"> www-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:rgb(255, 121, 198)">"apache2ctl"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"-D"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"FOREGROUND"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="对-run-多步操作进行压缩">对 RUN 多步操作进行压缩<a href="http://treasure-house.randark.site/blog/2024-08-18-Docker-Image-Chisel#%E5%AF%B9-run-%E5%A4%9A%E6%AD%A5%E6%93%8D%E4%BD%9C%E8%BF%9B%E8%A1%8C%E5%8E%8B%E7%BC%A9" class="hash-link" aria-label="对 RUN 多步操作进行压缩的直接链接" title="对 RUN 多步操作进行压缩的直接链接" translate="no">​</a></h2>
<p>由于每一个操作关键词 <code>RUN</code>, <code>COPY</code> 等都会在 image 中增加一个 layer 记录，带来额外的空间占用，所以可以对多个 <code>RUN</code> 语句进行整合</p>
<p>优化后的 Dockerfile 为</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token instruction"> ubuntu:22.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ARG</span><span class="token instruction"> DEBIAN_FRONTEND=noninteractive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> sed -i </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g'</span><span class="token instruction"> /etc/apt/sources.list &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    sed -i </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'s@//.*security.ubuntu.com@//mirrors.ustc.edu.cn@g'</span><span class="token instruction"> /etc/apt/sources.list &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    apt-get update &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    apt-get install -y --no-install-recommends apache2 libcap2-bin php libapache2-mod-php &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    apt clean &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    rm -rf /var/lib/apt/lists/* &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    setcap </span><span class="token instruction string" style="color:rgb(255, 121, 198)">'cap_net_bind_service=+ep'</span><span class="token instruction"> /usr/sbin/apache2 &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    </span><span class="token instruction comment" style="color:rgb(98, 114, 164)"># As apache is never run as root, change dir ownership</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    a2disconf other-vhosts-access-log &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    chown -Rh www-data:www-data /var/run/apache2 &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    chown -Rh www-data:www-data /var/log/apache2 &amp;&amp; </span><span class="token instruction operator">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    </span><span class="token instruction comment" style="color:rgb(98, 114, 164)"># Setup Apache2</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token instruction">    a2enmod rewrite headers expires ext_filter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> ./config/apache2.conf /etc/apache2/apache2.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Copy source page code and configure user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">COPY</span><span class="token instruction"> ./src/a.php /var/www/html/a.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">RUN</span><span class="token instruction"> echo </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"root:yourpassword"</span><span class="token instruction"> | chpasswd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">EXPOSE</span><span class="token instruction"> 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">USER</span><span class="token instruction"> www-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token instruction keyword" style="color:rgb(189, 147, 249);font-style:italic">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:rgb(255, 121, 198)">"apache2ctl"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"-D"</span><span class="token instruction">, </span><span class="token instruction string" style="color:rgb(255, 121, 198)">"FOREGROUND"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<p>优化之后的镜像大小为 <code>209MB</code></p>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="Docker" term="Docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker Swarm with Photon OS]]></title>
        <id>http://treasure-house.randark.site/blog/2024-03-19-Docker-Swarm-Init</id>
        <link href="http://treasure-house.randark.site/blog/2024-03-19-Docker-Swarm-Init"/>
        <updated>2024-03-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[文章内容为我个人的 Docker 实验集群，带有个人习惯，故并没有放在知识库正文]]></summary>
        <content type="html"><![CDATA[<p>文章内容为我个人的 Docker 实验集群，带有个人习惯，故并没有放在知识库正文</p>
<p>在文章开始之前，已经基于 Photon OS 部署了四台虚拟机，其中一台主节点，三台作为子节点</p>
<p><img decoding="async" loading="lazy" alt="img" src="http://treasure-house.randark.site/assets/images/image_20240335-163531-7f12e9d61ea7a1ec374209d6a09767c5.png" width="2048" height="1236" class="img_ev3q"></p>
<table><thead><tr><th style="text-align:center">hostname</th><th style="text-align:center">ip address</th></tr></thead><tbody><tr><td style="text-align:center">docker-main</td><td style="text-align:center">192.168.200.134</td></tr><tr><td style="text-align:center">docker-node-1</td><td style="text-align:center">192.168.200.135</td></tr><tr><td style="text-align:center">docker-node-2</td><td style="text-align:center">192.168.200.136</td></tr><tr><td style="text-align:center">docker-node-3</td><td style="text-align:center">192.168.200.137</td></tr></tbody></table>
<p>做好了前期工作</p>
<ul>
<li>更改每一台节点的 hostname</li>
<li>在每个节点上部署 clash 代理</li>
<li>每个节点的 Docker 均设置了 Daemon Proxy</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关闭防火墙">关闭防火墙<a href="http://treasure-house.randark.site/blog/2024-03-19-Docker-Swarm-Init#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99" class="hash-link" aria-label="关闭防火墙的直接链接" title="关闭防火墙的直接链接" translate="no">​</a></h2>
<p>由于此集群用于测试，所以在这个集群上不需要防火墙的保护措施</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl stop iptables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable iptables</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="为-tdnf-设置镜像加快软件包下载速度">为 <code>tdnf</code> 设置镜像，加快软件包下载速度<a href="http://treasure-house.randark.site/blog/2024-03-19-Docker-Swarm-Init#%E4%B8%BA-tdnf-%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E5%BF%AB%E8%BD%AF%E4%BB%B6%E5%8C%85%E4%B8%8B%E8%BD%BD%E9%80%9F%E5%BA%A6" class="hash-link" aria-label="为-tdnf-设置镜像加快软件包下载速度的直接链接" title="为-tdnf-设置镜像加快软件包下载速度的直接链接" translate="no">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /etc/tdnf/tdnf.conf</span><br></span></code></pre></div></div>
<p>在其中进行更改</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[main]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">installonly_limit=3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">clean_requirements_on_remove=0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">repodir=/etc/yum.repos.d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cachedir=/var/cache/tdnf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy=http://127.0.0.1:7890</span><br></span></code></pre></div></div>
<p>代理配置完毕之后，执行 <code>tdnf update</code></p>
<p>最终，四台虚拟机的软件包版本应该都是统一的最新版本</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="部署-docker-swarm">部署 Docker Swarm<a href="http://treasure-house.randark.site/blog/2024-03-19-Docker-Swarm-Init#%E9%83%A8%E7%BD%B2-docker-swarm" class="hash-link" aria-label="部署 Docker Swarm的直接链接" title="部署 Docker Swarm的直接链接" translate="no">​</a></h2>
<p>首先，现在主节点初始化 swarm</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-main </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker swarm init --advertise-addr 192.168.200.134</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Swarm initialized: current </span><span class="token function" style="color:rgb(80, 250, 123)">node</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pq6gku0fv2rfad9tt9np2bvzy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> is now a manager.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">To </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> a worker to this swarm, run the following command:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> swarm </span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--token</span><span class="token plain"> ****** </span><span class="token number">192.168</span><span class="token plain">.200.134:2377</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">To </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> a manager to this swarm, run </span><span class="token string" style="color:rgb(255, 121, 198)">'docker swarm join-token manager'</span><span class="token plain"> and follow the instructions.</span><br></span></code></pre></div></div>
<p>为了节点间通信的</p>
<p>然后将三台子节点加入到 swarm</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-node-1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker swarm join --token ****** 192.168.200.134:2377</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This </span><span class="token function" style="color:rgb(80, 250, 123)">node</span><span class="token plain"> joined a swarm as a worker.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-node-2 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker swarm join --token ****** 192.168.200.134:2377</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This </span><span class="token function" style="color:rgb(80, 250, 123)">node</span><span class="token plain"> joined a swarm as a worker.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-node-3 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker swarm join --token ****** 192.168.200.134:2377</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This </span><span class="token function" style="color:rgb(80, 250, 123)">node</span><span class="token plain"> joined a swarm as a worker.</span><br></span></code></pre></div></div>
<p>在 <code>docker-main</code> 节点上查询整个 swarm 状态</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-main </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker node ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID                            </span><span class="token environment constant" style="color:rgb(189, 147, 249)">HOSTNAME</span><span class="token plain">        STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pq6gku0fv2rfad9tt9np2bvzy *   docker-main     Ready     Active         Leader           </span><span class="token number">24.0</span><span class="token plain">.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">n00jzhnp2ttlkdxw53t0o7yf9     docker-node-1   Ready     Active                          </span><span class="token number">24.0</span><span class="token plain">.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">suk0amyclojgcm0ykt9ah3l8t     docker-node-2   Ready     Active                          </span><span class="token number">24.0</span><span class="token plain">.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gh480lkdg3f447zu26m7xl2y9     docker-node-3   Ready     Active                          </span><span class="token number">24.0</span><span class="token plain">.5</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="部署-portainer">部署 Portainer<a href="http://treasure-house.randark.site/blog/2024-03-19-Docker-Swarm-Init#%E9%83%A8%E7%BD%B2-portainer" class="hash-link" aria-label="部署 Portainer的直接链接" title="部署 Portainer的直接链接" translate="no">​</a></h2>
<p>首先，下载堆栈配置文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-L</span><span class="token plain"> https://downloads.portainer.io/ce2-19/portainer-agent-stack.yml </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-o</span><span class="token plain"> portainer-agent-stack.yml</span><br></span></code></pre></div></div>
<p>文件内容为</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_OeMC">portainer-agent-stack.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'3.2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> portainer/agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">2.19.4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> /var/lib/docker/volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/var/lib/docker/volumes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> agent_network</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">deploy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">placement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">constraints</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">node.platform.os == linux</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">portainer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> portainer/portainer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">2.19.4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">H tcp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//tasks.agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">9001 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">tlsskipverify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"9443:9443"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"9000:9000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"8000:8000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> portainer_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> agent_network</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">deploy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> replicated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">placement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">constraints</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">node.role == manager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">agent_network</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> overlay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">attachable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  portainer_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><br></span></code></pre></div></div>
<p>然后部署堆栈</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-main </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker stack deploy -c portainer-agent-stack.yml portainer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Creating network portainer_agent_network</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Creating </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> portainer_portainer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Creating </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> portainer_agent</span><br></span></code></pre></div></div>
<p>查看服务状态</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-main </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker stack ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME        SERVICES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">portainer   </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@docker-main </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker service ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID             NAME                  MODE         REPLICAS   IMAGE                           PORTS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0u1bzfeo2gir   portainer_agent       global       </span><span class="token number">4</span><span class="token plain">/4        portainer/agent:2.19.4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ywjdr6qpsbjw   portainer_portainer   replicated   </span><span class="token number">1</span><span class="token plain">/1        portainer/portainer-ce:2.19.4   *:8000-</span><span class="token operator">&gt;</span><span class="token number">8000</span><span class="token plain">/tcp, *:9000-</span><span class="token operator">&gt;</span><span class="token number">9000</span><span class="token plain">/tcp, *:9443-</span><span class="token operator">&gt;</span><span class="token number">9443</span><span class="token plain">/tcp</span><br></span></code></pre></div></div>
<p>Portainer 服务已经成功启动，访问 <code>https://192.168.200.134:9443</code> 之后进行初始化配置，随后即可看到 Portainer 环境状态</p>
<p><img decoding="async" loading="lazy" alt="img" src="http://treasure-house.randark.site/assets/images/image_20240317-181715-f054f7dad0018c1f5b85b4f576d2cbd9.png" width="2560" height="1371" class="img_ev3q"></p>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[0xGame2023 oh-my-linux 技术分析]]></title>
        <id>http://treasure-house.randark.site/blog/2023-10-26-0xGame2023-oh-my-linux</id>
        <link href="http://treasure-house.randark.site/blog/2023-10-26-0xGame2023-oh-my-linux"/>
        <updated>2023-10-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[将我的 profile-builder 项目实际应用在 CTF 题目中的例子]]></summary>
        <content type="html"><![CDATA[<p>将我的 profile-builder 项目实际应用在 CTF 题目中的例子</p>
<p>首先，先分析镜像的内核信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> oh-my-linux.mem banner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  </span><span class="token number">100.00</span><span class="token plain">               PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offset  Banner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x4f000200      Linux version </span><span class="token number">5.10</span><span class="token plain">.0-21-amd64 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">debian-kernel@lists.debian.org</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">gcc-10 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Debian </span><span class="token number">10.2</span><span class="token plain">.1-6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">10.2</span><span class="token plain">.1 </span><span class="token number">20210110</span><span class="token plain">, GNU ld </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">GNU Binutils </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Debian</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">2.35</span><span class="token plain">.2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#1 SMP Debian 5.10.162-1 (2023-01-21)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x58ecc240      Linux version </span><span class="token number">5.10</span><span class="token plain">.0-21-amd64 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">debian-kernel@lists.debian.org</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">gcc-10 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Debian </span><span class="token number">10.2</span><span class="token plain">.1-6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">10.2</span><span class="token plain">.1 </span><span class="token number">20210110</span><span class="token plain">, GNU ld </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">GNU Binutils </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Debian</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">2.35</span><span class="token plain">.2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#1 SMP Debian 5.10.162-1 (2023-01-21)</span><br></span></code></pre></div></div>
<p>通过内核信息，可以定位到 <code>Debian 5.10.0-21-amd64</code> 的 deb 发行包文件：</p>
<p><a href="https://debian.sipwise.com/debian-security/pool/main/l/linux/" target="_blank" rel="noopener noreferrer">Index of /debian-security/pool/main/l/linux</a></p>
<p><img decoding="async" loading="lazy" alt="linux-image-5.10.0-21-amd64-dbg_5.10.162-1_amd64.deb" src="http://treasure-house.randark.site/assets/images/image_20231022-192239-e7d3586f04208df3e0a905e4f70cbff4.png" width="1920" height="1050" class="img_ev3q"></p>
<p>下载下来后，将其作为 <code>tar.xz</code> 文件进行解压缩，得到 <code>data.tar</code> 文件，解压缩制作符号表需要的文件：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~/linux-image$ </span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-xvf</span><span class="token plain"> data.tar ./usr/lib/debug/boot/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./usr/lib/debug/boot/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./usr/lib/debug/boot/System.map-5.10.0-21-amd64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./usr/lib/debug/boot/vmlinux-5.10.0-21-amd64</span><br></span></code></pre></div></div>
<p>然后开始制作符号表文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$  ./dwarf2json linux --system-map ~/linux-image/usr/lib/debug/boot/System.map-5.10.0-21-amd64 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--elf</span><span class="token plain"> ~/linux-image/usr/lib/debug/boot/vmlinux-5.10.0-21-amd64  </span><span class="token operator">&gt;</span><span class="token plain">  linux-image-5.10.0-21-amd64-dbg_5.10.162-1_amd64.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> linux-image-5.10.0-21-amd64-dbg_5.10.162-1_amd64.json /usr/local/lib/python3.10/dist-packages/volatility3/symbols/linux/</span><br></span></code></pre></div></div>
<p>尝试使用符号表进行分析：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> oh-my-linux.mem linux.pslist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  </span><span class="token number">100.00</span><span class="token plain">               Stacking attempts finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID     </span><span class="token environment constant" style="color:rgb(189, 147, 249)">PPID</span><span class="token plain">    COMM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain">       </span><span class="token number">0</span><span class="token plain">       systemd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2</span><span class="token plain">       </span><span class="token number">0</span><span class="token plain">       kthreadd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain">       rcu_gp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">4</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain">       rcu_par_gp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">6</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain">       kworker/0:0H</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">8</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain">       mm_percpu_wq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">9</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain">       rcu_tasks_rude_</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">10</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       rcu_tasks_trace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">11</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       ksoftirqd/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">12</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       rcu_sched</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">13</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       migration/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">14</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kworker/0:1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">15</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       cpuhp/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">17</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kdevtmpfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">18</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       netns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">19</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kauditd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">20</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       khungtaskd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">21</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       oom_reaper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">22</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       writeback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">23</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kcompactd0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">24</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       ksmd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">25</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       khugepaged</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">43</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kintegrityd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">44</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kblockd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">45</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       blkcg_punt_bio</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">46</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       edac-poller</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">47</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       devfreq_wq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">48</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kworker/0:1H</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">49</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kswapd0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">50</span><span class="token plain">      </span><span class="token number">2</span><span class="token plain">       kthrotld</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><br></span></code></pre></div></div>
<p>成功实现 Volatility3 加载符号表，并分析镜像</p>
<p>如果要使用 Volatility2 进行分析的话，需要使用 linux-header,linux-image 等相关软件包进行编译，为了不影响主机环境，以及懒得开虚拟机的话，可以使用 docker 进行编译：</p>
<p><a href="https://github.com/CTF-Archives/profile-builder" target="_blank" rel="noopener noreferrer">CTF-Archives / profile-builder</a></p>
<p>编译后，应该会在 <code>./docker/data</code> 目录下得到编译好的 dwarf 文件，即可开始组装适用于 Volatility2 的配置文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 这里用的 System.map 文件，为上面拆 deb 包得到的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token plain"> Debian_5.10.0-21-amd64_profile.zip module.dwarf ~/linux-image/usr/lib/debug/boot/System.map-5.10.0-21-amd64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> Debian_5.10.0-21-amd64_profile.zip ./volatility2/volatility/plugins/overlays/linux/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ python2 ./volatility2/vol.py </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--info</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> Profile </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> Linux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility Foundation Volatility Framework </span><span class="token number">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LinuxDebian_5_10_0-21-amd64_profilex64  - A Profile </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Linux Debian_5.10.0-21-amd64_profile x64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LinuxUbuntu_6_2_0-35-generic_profilex64 - A Profile </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Linux Ubuntu_6.2.0-35-generic_profile x64</span><br></span></code></pre></div></div>
<p>成功制作并在 Volatility2 中加载了配置文件，并工作正常</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ python2 ./volatility2/vol.py </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> oh-my-linux.mem </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--profile</span><span class="token operator">=</span><span class="token plain">LinuxDebian_5_10_0-21-amd64_profilex64 linux_bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility Foundation Volatility Framework </span><span class="token number">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> volatility.debug    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Overlay structure cpuinfo_x86 not present </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> volatility.debug    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Overlay structure cpuinfo_x86 not present </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pid      Name                 Command Time                   Command</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-------- -------------------- ------------------------------ -------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">1014</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain">                 </span><span class="token number">2023</span><span class="token plain">-02-25 </span><span class="token number">15</span><span class="token plain">:45:08 UTC+0000   </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$SHELL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">1014</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain">                 </span><span class="token number">2023</span><span class="token plain">-02-25 </span><span class="token number">15</span><span class="token plain">:45:23 UTC+0000   </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Bash doesn't feel as good as zsh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">1014</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain">                 </span><span class="token number">2023</span><span class="token plain">-02-25 </span><span class="token number">15</span><span class="token plain">:45:27 UTC+0000   </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"lol"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">1014</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain">                 </span><span class="token number">2023</span><span class="token plain">-02-25 </span><span class="token number">15</span><span class="token plain">:45:29 UTC+0000   </span><span class="token function" style="color:rgb(80, 250, 123)">zsh</span><br></span></code></pre></div></div>
<p>读取 zsh 的历史记录，就能知道怎么解题了</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> a1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677339944</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$SHELL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677339951</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340139</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-c</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">curl</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token string variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-fsSL</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340199</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$SHELL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340205</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"nice"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340215</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> mysecretflag1.zsh-theme ~/.oh-my-zsh/themes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340217</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340222</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> ~/.zshrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340268</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> ~/.zshrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340271</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340299</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-o</span><span class="token plain"> flag2.zip flag2.txt </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-P</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$SHELL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340311</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-rf</span><span class="token plain"> flag2.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340315</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340324</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">G1v3m3F14ggg3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340335</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"lol"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1677340354</span><span class="token plain">:0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> ./avml oh-my-linux.mem</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="Memory-Forensic" term="Memory-Forensic"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[内存取证实验 - 镜像 + 配置文件]]></title>
        <id>http://treasure-house.randark.site/blog/2023-10-25-MemoryForensic-Test</id>
        <link href="http://treasure-house.randark.site/blog/2023-10-25-MemoryForensic-Test"/>
        <updated>2023-10-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[只是一个 Linux 内存取证实验]]></summary>
        <content type="html"><![CDATA[<p>只是一个 Linux 内存取证实验</p>
<p>新建虚拟机，使用 <code>ubuntu-22.04.2-desktop-amd64.iso</code> 作为安装镜像，正常完成安装，选择最小化安装，并且安装过程中不进行自动更新</p>
<p><img decoding="async" loading="lazy" alt="Ubuntu install option" src="http://treasure-house.randark.site/assets/images/image_20231037-233754-7cad03aaa7d37dd3e9f21d09d9f8fe55.png" width="1280" height="768" class="img_ev3q"></p>
<p>等待安装完成后，为纯净状态制作快照</p>
<p><img decoding="async" loading="lazy" alt="Vmware Create Init Capture" src="http://treasure-house.randark.site/assets/images/image_20231046-234659-799a2dca4087bd107b3e36aa0e9ae902.png" width="1920" height="1058" class="img_ev3q"></p>
<p>然后安装必要的软件包：</p>
<ul>
<li>openssh-server</li>
<li>make</li>
<li>gcc</li>
<li>net-tools</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">nano</span><span class="token plain"> /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 将 apt 的源仓库地址换为 ustc 中科大源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> openssh-server gcc </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> net-tools</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Synchronizing state of ssh.service with SysV </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> script with /lib/systemd/systemd-sysv-install.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Executing: /lib/systemd/systemd-sysv-install </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl start </span><span class="token function" style="color:rgb(80, 250, 123)">ssh</span><br></span></code></pre></div></div>
<p>然后，通过 ssh 与 sftp 进行操作：首先，将 <a href="https://github.com/microsoft/avml" target="_blank" rel="noopener noreferrer">AVML</a> 的二进制文件传输到测试机上，并授予执行权限，然后开始制作镜像</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> +x avml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> ./avml out.lime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total </span><span class="token number">4</span><span class="token plain">.1G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxrwxr-x </span><span class="token number">1</span><span class="token plain"> randark randark </span><span class="token number">6</span><span class="token plain">.4M </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">26</span><span class="token plain"> 00:01 avml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- </span><span class="token number">1</span><span class="token plain"> root    root    </span><span class="token number">4</span><span class="token plain">.0G </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">26</span><span class="token plain"> 00:02 out.lime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ </span><span class="token number">3</span><span class="token plain"> randark randark </span><span class="token number">4</span><span class="token plain">.0K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">25</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:52 snap</span><br></span></code></pre></div></div>
<p>成功得到 <code>out.lime</code> 内存镜像文件</p>
<p>接下来，开始构建 <code>dwarf</code> 内核调试文件，与获取 <code>System.map</code> 内存表文件</p>
<p>首先，确定 Linux Kernel 的版本</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">uname</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Linux randark-test </span><span class="token number">6.2</span><span class="token plain">.0-35-generic </span><span class="token comment" style="color:rgb(98, 114, 164)">#35~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Fri Oct  6 10:23:26 UTC 2 x86_64 x86_64 x86_64 GNU/Linux</span><br></span></code></pre></div></div>
<p>然后传输 dwarf 内核调试文件的编译文件：<a href="https://github.com/volatilityfoundation/volatility/tree/master/tools/linux" target="_blank" rel="noopener noreferrer">volatility/tools/linux</a>，并尝试进行编译</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 32K</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxrwxr-x </span><span class="token number">2</span><span class="token plain"> randark randark </span><span class="token number">4</span><span class="token plain">.0K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 kcore</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  </span><span class="token number">384</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 Makefile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  </span><span class="token number">314</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 Makefile.enterprise</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  18K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 module.c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-C</span><span class="token plain"> //lib/modules/6.2.0-35-generic/build </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CONFIG_DEBUG_INFO</span><span class="token operator">=</span><span class="token plain">y </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">M</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/linux"</span><span class="token plain"> modules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">warning: the compiler differs from the one used to build the kernel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  The kernel was built by: x86_64-linux-gnu-gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  You are using:           gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/home/randark/linux/module.c:136: warning: </span><span class="token string" style="color:rgb(255, 121, 198)">"__rcu"</span><span class="token plain"> redefined</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token number">136</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#define __rcu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">In </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> included from </span><span class="token operator">&lt;</span><span class="token plain">command-line</span><span class="token operator">&gt;</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">././include/linux/compiler_types.h:52: note: this is the location of the previous definition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># define __rcu          BTF_TYPE_TAG(rcu)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MODPOST /home/randark/linux/Module.symvers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ERROR: modpost: missing MODULE_LICENSE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> /home/randark/linux/module.o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: *** </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">scripts/Makefile.modpost:138: /home/randark/linux/Module.symvers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Error </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: *** </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Makefile:1978: modpost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Error </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make: *** </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Makefile:10: dwarf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Error </span><span class="token number">2</span><br></span></code></pre></div></div>
<p>可以发现编译过程中存在致命错误：<code>modpost: missing MODULE_LICENSE() in /home/randark/linux/module.o</code></p>
<p>在 <code>module.c</code> 的文件末尾加上以下语句：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">MODULE_LICENSE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"GPL"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>或者执行：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MODULE_LICENSE("GPL");'</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> module.c</span><br></span></code></pre></div></div>
<p>继续尝试编译：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-C</span><span class="token plain"> //lib/modules/6.2.0-35-generic/build </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CONFIG_DEBUG_INFO</span><span class="token operator">=</span><span class="token plain">y </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">M</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/linux"</span><span class="token plain"> modules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">warning: the compiler differs from the one used to build the kernel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  The kernel was built by: x86_64-linux-gnu-gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  You are using:           gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/home/randark/linux/module.c:136: warning: </span><span class="token string" style="color:rgb(255, 121, 198)">"__rcu"</span><span class="token plain"> redefined</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token number">136</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#define __rcu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">In </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> included from </span><span class="token operator">&lt;</span><span class="token plain">command-line</span><span class="token operator">&gt;</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">././include/linux/compiler_types.h:52: note: this is the location of the previous definition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># define __rcu          BTF_TYPE_TAG(rcu)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MODPOST /home/randark/linux/Module.symvers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.mod.o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.ko</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  BTF </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> /home/randark/linux/module.ko</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Skipping BTF generation </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> /home/randark/linux/module.ko due to unavailability of vmlinux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dwarfdump </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-di</span><span class="token plain"> module.ko </span><span class="token operator">&gt;</span><span class="token plain"> module.dwarf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/bin/sh: </span><span class="token number">1</span><span class="token plain">: dwarfdump: not found</span><br></span></code></pre></div></div>
<p>继续发现存在致命错误：<code>/bin/sh: 1: dwarfdump: not found</code></p>
<p>查阅相关文档 <a href="https://github.com/volatilityfoundation/volatility/wiki/Linux#creating-a-new-profile" target="_blank" rel="noopener noreferrer">Creating a new profile</a> 后，得知需要安装以下工具：</p>
<ul>
<li>dwarfdump</li>
</ul>
<p>继续尝试编译：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-C</span><span class="token plain"> //lib/modules/6.2.0-35-generic/build </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CONFIG_DEBUG_INFO</span><span class="token operator">=</span><span class="token plain">y </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">M</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/linux"</span><span class="token plain"> modules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">warning: the compiler differs from the one used to build the kernel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  The kernel was built by: x86_64-linux-gnu-gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  You are using:           gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/home/randark/linux/module.c:136: warning: </span><span class="token string" style="color:rgb(255, 121, 198)">"__rcu"</span><span class="token plain"> redefined</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token number">136</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#define __rcu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">In </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> included from </span><span class="token operator">&lt;</span><span class="token plain">command-line</span><span class="token operator">&gt;</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">././include/linux/compiler_types.h:52: note: this is the location of the previous definition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># define __rcu          BTF_TYPE_TAG(rcu)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MODPOST /home/randark/linux/Module.symvers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.mod.o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  /home/randark/linux/module.ko</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  BTF </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> /home/randark/linux/module.ko</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Skipping BTF generation </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> /home/randark/linux/module.ko due to unavailability of vmlinux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dwarfdump </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-di</span><span class="token plain"> module.ko </span><span class="token operator">&gt;</span><span class="token plain"> module.dwarf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-C</span><span class="token plain"> //lib/modules/6.2.0-35-generic/build </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">M</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/linux"</span><span class="token plain"> clean</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CLEAN   /home/randark/linux/Module.symvers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:rgb(255, 121, 198)">'/usr/src/linux-headers-6.2.0-35-generic'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total </span><span class="token number">3</span><span class="token plain">.0M</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxrwxr-x </span><span class="token number">2</span><span class="token plain"> randark randark </span><span class="token number">4</span><span class="token plain">.0K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 kcore</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  </span><span class="token number">384</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 Makefile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  </span><span class="token number">314</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 Makefile.enterprise</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  18K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">26</span><span class="token plain"> 00:14 module.c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark </span><span class="token number">2</span><span class="token plain">.9M </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">26</span><span class="token plain"> 00:19 module.dwarf</span><br></span></code></pre></div></div>
<p>成功得到了 dwarf 内核调试文件。接下来获取 <code>System.map</code> 内存表文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"> /boot/System.map-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">uname</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- </span><span class="token number">1</span><span class="token plain"> root root </span><span class="token number">7</span><span class="token plain">.7M </span><span class="token number">10</span><span class="token plain"> 月  </span><span class="token number">6</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain">:29 /boot/System.map-6.2.0-35-generic</span><br></span></code></pre></div></div>
<p>确定 <code>System.map</code> 内存表文件的路径之后，就可以开始打包适用于 Volatility2 的配置文件：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@randark-test:~/linux$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">lsb_release </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-i</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-s</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain">_</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">uname</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain">_profile.zip module.dwarf /boot/System.map-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">uname</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  adding: module.dwarf </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">deflated </span><span class="token number">91</span><span class="token plain">%</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  adding: boot/System.map-6.2.0-35-generic </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">deflated </span><span class="token number">82</span><span class="token plain">%</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<p>成功得到适用于 Volatility2 的配置文件，以及内存镜像之后，就可以使用 Volatility2 进行分析。首先，将制作好的配置文件加入到 Volatility2 的配置文件文件夹</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> Ubuntu_6.2.0-35-generic_profile.zip ./volatility2/volatility/plugins/overlays/linux/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ python2 ./volatility2/vol.py </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--info</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> Profile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility Foundation Volatility Framework </span><span class="token number">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Profiles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LinuxUbuntu_6_2_0-35-generic_profilex64 - A Profile </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Linux Ubuntu_6.2.0-35-generic_profile x64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><br></span></code></pre></div></div>
<p>然后使用 profile 进行内存镜像的解析</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ python2 ./volatility2/vol.py </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> ~/out.lime linux_banner </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--profile</span><span class="token operator">=</span><span class="token plain">LinuxUbuntu_6_2_0-35-generic_profilex64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility Foundation Volatility Framework </span><span class="token number">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Traceback </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"./volatility2/vol.py"</span><span class="token plain">, line </span><span class="token number">192</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">module</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    main</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"./volatility2/vol.py"</span><span class="token plain">, line </span><span class="token number">183</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    command.execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/plugins/linux/common.py"</span><span class="token plain">, line </span><span class="token number">67</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> execute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    commands.Command.execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self, *args, **kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/commands.py"</span><span class="token plain">, line </span><span class="token number">116</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> execute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> not self.is_valid_profile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">profs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">self._config.PROFILE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">))</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/plugins/overlays/linux/linux.py"</span><span class="token plain">, line </span><span class="token number">218</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> __init__</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    obj.Profile.__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self, *args, **kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/obj.py"</span><span class="token plain">, line </span><span class="token number">862</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> __init__</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.reset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/plugins/overlays/linux/linux.py"</span><span class="token plain">, line </span><span class="token number">232</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> reset</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.load_vtypes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/plugins/overlays/linux/linux.py"</span><span class="token plain">, line </span><span class="token number">269</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> load_vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vtypesvar </span><span class="token operator">=</span><span class="token plain"> dwarf.DWARFParser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dwarfdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.finalize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/dwarf.py"</span><span class="token plain">, line </span><span class="token number">72</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> __init__</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.feed_line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/dwarf.py"</span><span class="token plain">, line </span><span class="token number">163</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> feed_line</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.process_statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">**parsed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#pylint: disable-msg=W0142</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/randark/volatility2/volatility/dwarf.py"</span><span class="token plain">, line </span><span class="token number">267</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> process_statement</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'DW_AT_data_member_location'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">KeyError: </span><span class="token string" style="color:rgb(255, 121, 198)">'DW_AT_data_member_location'</span><br></span></code></pre></div></div>
<p>经过对这个报错的跟踪，发现已有人提出了相关 issue：<a href="https://github.com/volatilityfoundation/volatility/issues/828" target="_blank" rel="noopener noreferrer">Linux Profile Error - KeyError: 'DW_AT_data_member_location' #828</a></p>
<p>根据 issue 的发展历史，可以定位到问题的起因是 Volatility2 对于新版 dwarfdump 生成的 dwarf 文件的支持性不加所导致的。将前辈所制作的新版 <code>dwarf.py</code> <a href="https://github.com/volatilityfoundation/volatility/blob/7113c441d74a8fa1b8d5c056e77900e500453287/volatility/dwarf.py" target="_blank" rel="noopener noreferrer">volatility/dwarf.py</a> 替换掉原版 Volatility2 的 <code>dwarf.py</code> 文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~/volatility2/volatility$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> dwarf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  15K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 dwarf.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~/volatility2/volatility$ </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> dwarf.py dwarf.py.bak</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~/volatility2/volatility$ </span><span class="token function" style="color:rgb(80, 250, 123)">nano</span><span class="token plain"> dwarf.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~/volatility2/volatility$ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-lh</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> dwarf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  16K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">26</span><span class="token plain"> 00:48 dwarf.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- </span><span class="token number">1</span><span class="token plain"> randark randark  15K </span><span class="token number">10</span><span class="token plain"> 月 </span><span class="token number">24</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:54 dwarf.py.bak</span><br></span></code></pre></div></div>
<p>再次尝试分析：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ python2 ./volatility2/vol.py </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> ~/out.lime </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--profile</span><span class="token operator">=</span><span class="token plain">LinuxUbuntu_6_2_0-35-generic_profilex64 linux_banner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility Foundation Volatility Framework </span><span class="token number">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> volatility.debug    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Overlay structure cpuinfo_x86 not present </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> volatility.debug    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Overlay structure cpuinfo_x86 not present </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">No suitable address space mapping found</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Tried to </span><span class="token function" style="color:rgb(80, 250, 123)">open</span><span class="token plain"> image as:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> MachOAddressSpace: mac: need base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LimeAddressSpace: lime: need base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsHiberFileSpace32: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsCrashDumpSpace64BitMap: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsCrashDumpSpace64: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> HPAKAddressSpace: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> VMWareMetaAddressSpace: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> VirtualBoxCoreDumpElf64: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> VMWareAddressSpace: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> QemuCoreDumpElf: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsCrashDumpSpace32: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> SkipDuplicatesAMD64PagedMemory: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsAMD64PagedMemory: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LinuxAMD64PagedMemory: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> AMD64PagedMemory: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> IA32PagedMemoryPae: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> IA32PagedMemory: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> OSXPmemELF: No base Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> MachOAddressSpace: MachO Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> MachOAddressSpace: MachO Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LimeAddressSpace: Invalid Lime header signature</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsHiberFileSpace32: PO_MEMORY_IMAGE is not available </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> profile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsCrashDumpSpace64BitMap: Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsCrashDumpSpace64: Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> HPAKAddressSpace: Invalid magic found</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> VMWareMetaAddressSpace: VMware metadata </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> is not available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> VirtualBoxCoreDumpElf64: ELF Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> VMWareAddressSpace: Invalid VMware signature: -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> QemuCoreDumpElf: ELF Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsCrashDumpSpace32: Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> SkipDuplicatesAMD64PagedMemory: Incompatible profile LinuxUbuntu_6_2_0-35-generic_profilex64 selected</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> WindowsAMD64PagedMemory: Incompatible profile LinuxUbuntu_6_2_0-35-generic_profilex64 selected</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LinuxAMD64PagedMemory - EXCEPTION: </span><span class="token string" style="color:rgb(255, 121, 198)">'state'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> AMD64PagedMemory - EXCEPTION: </span><span class="token string" style="color:rgb(255, 121, 198)">'state'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> IA32PagedMemoryPae: Incompatible profile LinuxUbuntu_6_2_0-35-generic_profilex64 selected</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> IA32PagedMemory: Incompatible profile LinuxUbuntu_6_2_0-35-generic_profilex64 selected</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> OSXPmemELF: ELF Header signature invalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> FileAddressSpace: Must be first Address Space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ArmAddressSpace - EXCEPTION: </span><span class="token string" style="color:rgb(255, 121, 198)">'state'</span><br></span></code></pre></div></div>
<p>很不幸，依然存在问题。根据问题细节，可以追踪到这个 issue：<a href="https://github.com/volatilityfoundation/volatility/pull/852" target="_blank" rel="noopener noreferrer">Update Linux DTB scanner to handle newer Linux kernel versions (&gt;= 5.14-rc1) #852</a></p>
<p>根据 issue 中前辈们给出的方案，将这两个 PR 做出的更改加入到本地的 Volatility2 源码中</p>
<ul>
<li><a href="https://github.com/volatilityfoundation/volatility/pull/852/commits/9ff9e9bb9103d63cbb278e991209aa11cffc61ce" target="_blank" rel="noopener noreferrer">Update Linux DTB scanner to handle newer Linux kernel versions (&gt;= 5.14-rc1) #852</a></li>
</ul>
<p><img decoding="async" loading="lazy" alt="PR #852 #1" src="http://treasure-house.randark.site/assets/images/image_20231058-005841-92ad9c9cdf57c3591cad8f7e85e695a9.png" width="1920" height="1050" class="img_ev3q"></p>
<ul>
<li><a href="https://github.com/volatilityfoundation/volatility/pull/852/commits/d07c69a7811d8e18ab186c9fbdf5b050529d06d2" target="_blank" rel="noopener noreferrer">Update Linux DTB scanner to handle newer Linux kernel versions (&gt;= 5.14-rc1) #852</a></li>
</ul>
<p><img decoding="async" loading="lazy" alt="PR #852 #2" src="http://treasure-house.randark.site/assets/images/image_20231000-010045-67fae8021f55ac57dc3e9a23836f17a3.png" width="1920" height="1050" class="img_ev3q"></p>
<p>继续尝试分析：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">randark@memory-forensic:~$ python2 ./volatility2/vol.py </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> ~/out.lime </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--profile</span><span class="token operator">=</span><span class="token plain">LinuxUbuntu_6_2_0-35-generic_profilex64 linux_banner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility Foundation Volatility Framework </span><span class="token number">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> volatility.debug    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Overlay structure cpuinfo_x86 not present </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> volatility.debug    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Overlay structure cpuinfo_x86 not present </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> vtypes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Linux version </span><span class="token number">6.2</span><span class="token plain">.0-35-generic </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buildd@bos03-amd64-016</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x86_64-linux-gnu-gcc-11 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Ubuntu </span><span class="token number">11.4</span><span class="token plain">.0-1ubuntu1~22.04</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">11.4</span><span class="token plain">.0, GNU ld </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">GNU Binutils </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Ubuntu</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">2.38</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#35~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Fri Oct  6 10:23:26 UTC 2 (Ubuntu 6.2.0-35.35~22.04.1-gene</span><br></span></code></pre></div></div>
<p>成功基于配置文件，实现对内存镜像的读取分析</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参考资料">参考资料<a href="http://treasure-house.randark.site/blog/2023-10-25-MemoryForensic-Test#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="hash-link" aria-label="参考资料的直接链接" title="参考资料的直接链接" translate="no">​</a></h3>
<p><a href="https://andreafortuna.org/2019/08/22/how-to-generate-a-volatility-profile-for-a-linux-system/" target="_blank" rel="noopener noreferrer">How to generate a Volatility profile for a Linux system</a></p>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="Memory-Forensic" term="Memory-Forensic"/>
    </entry>
</feed>